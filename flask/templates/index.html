<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ricerca Repository</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4">Ricerca Repository GitHub</h1>
        <form id="searchForm" class="bg-white p-4 rounded shadow-md">
            <div class="mb-4">
                <label for="linguaggio" class="block text-gray-700">Linguaggio</label>
                <input type="text" id="linguaggio" name="linguaggio" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300" required>
            </div>
            <div class="mb-4">
                <label for="risultati_per_pagina" class="block text-gray-700">Risultati per pagina</label>
                <input type="number" id="risultati_per_pagina" name="risultati_per_pagina" value="10" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300">
            </div>
            <div class="mb-4">
                <label for="pagine" class="block text-gray-700">Numero di pagine</label>
                <input type="number" id="pagine" name="pagine" value="1" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300">
            </div>
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Cerca</button>
        </form>
        <button id="sendButton" class="bg-green-500 text-white px-4 py-2 rounded mt-4">Invia a RabbitMQ</button>
        <div id="results" class="mt-4"></div>
    </div>

    <script>
        document.getElementById('searchForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const linguaggio = document.getElementById('linguaggio').value;
            const risultati_per_pagina = document.getElementById('risultati_per_pagina').value;
            const pagine = document.getElementById('pagine').value;

            axios.post('/search', {
                linguaggio: linguaggio,
                risultati_per_pagina: risultati_per_pagina,
                pagine: pagine
            })
            .then(function (response) {
                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = '';
                if (response.data.status === 'success') {
                    const ul = document.createElement('ul');
                    response.data.repositories.forEach(repo => {
                        const li = document.createElement('li');
                        li.innerHTML = `<a href="${repo}" target="_blank" class="text-blue-500">${repo}</a>`;
                        ul.appendChild(li);
                    });
                    resultsDiv.appendChild(ul);
                } else {
                    resultsDiv.innerHTML = `<p class="text-red-500">${response.data.message}</p>`;
                }
            })
            .catch(function (error) {
                console.error(error);
            });
        });

        document.getElementById('sendButton').addEventListener('click', function() {
            axios.post('/send')
            .then(function (response) {
                alert(response.data.message);
            })
            .catch(function (error) {
                console.error(error);
            });
        });
    </script>
</body>
</html>
